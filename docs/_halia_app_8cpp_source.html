<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Halia: HaliaApp.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>HaliaApp.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "HaliaApp.hpp"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">namespace </span>Halia
<a name="l00004"></a>00004 {
<a name="l00005"></a><a class="code" href="class_halia_1_1_halia_app.html#940a53f8b5675f4bf7b8ba4762f5a369">00005</a>       <a class="code" href="class_halia_1_1_halia_app.html#940a53f8b5675f4bf7b8ba4762f5a369" title="Constructor.">HaliaApp::HaliaApp</a>( )
<a name="l00006"></a>00006             : mWindow( 0 )
<a name="l00007"></a>00007       {
<a name="l00008"></a>00008             strcpy( mSFps[0], <span class="stringliteral">"FPS: [CALCULATING]"</span> );
<a name="l00009"></a>00009             strcpy( mSFps[1], <span class="stringliteral">"Average Prim Count: [CALCULATING]"</span> );
<a name="l00010"></a>00010             strcpy( mSFps[2], <span class="stringliteral">"Average Batch Count: [CALCULATING]"</span> );
<a name="l00011"></a>00011       };
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="class_halia_1_1_halia_app.html#1428b174560ab93ffb97ed73ad79a7d8">00013</a>       <a class="code" href="class_halia_1_1_halia_app.html#1428b174560ab93ffb97ed73ad79a7d8" title="Destructor.">HaliaApp::~HaliaApp</a>( )
<a name="l00014"></a>00014       {
<a name="l00015"></a>00015       };
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="class_halia_1_1_halia_app.html#284e4dbc2609feee614bc41c39b1f068">00017</a>       <span class="keywordtype">bool</span> <a class="code" href="class_halia_1_1_halia_app.html#284e4dbc2609feee614bc41c39b1f068" title="Initialize the application.">HaliaApp::Init</a>( RendererType::RendererType rtype, <span class="keywordtype">bool</span> wndauto, std::string wndtitle, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height )
<a name="l00018"></a>00018       {
<a name="l00019"></a>00019             <span class="comment">//:: Initialize render window module</span>
<a name="l00020"></a>00020             mWindow = <span class="keyword">new</span> <a class="code" href="class_halia_1_1_window.html" title="A class to encapsulate creating and destroying a simple window. Generally used for...">Window</a>( );
<a name="l00021"></a>00021             mWindow-&gt;<a class="code" href="class_halia_1_1_window.html#f2b3ad7fe0f88927ab095ad0a620dd8c" title="Initialize the window.">Init</a>( wndtitle, width, height );
<a name="l00022"></a>00022             HLOGMSG( <span class="stringliteral">"Render Window created"</span> );
<a name="l00023"></a>00023 
<a name="l00024"></a>00024             <a class="code" href="namespace_halia.html#7682800f8df7294f6baf6c7e8d56fbad" title="Initializes the 2d and 3d rendering engine, as requested.">Halia::InitRenderer</a>( rtype, mWindow-&gt;<a class="code" href="class_halia_1_1_window.html#21f6104a7f071d50ba1ae316a17d90f0" title="Get the HWND of the underlying window.">GetHwnd</a>( ), width, height, false );
<a name="l00025"></a>00025 
<a name="l00026"></a>00026             <span class="comment">// * Good loadin boyz</span>
<a name="l00027"></a>00027             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00028"></a>00028       };
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="class_halia_1_1_halia_app.html#9fe2cee5f11e166665bab6e6613ef985">00030</a>       <span class="keywordtype">void</span> <a class="code" href="class_halia_1_1_halia_app.html#9fe2cee5f11e166665bab6e6613ef985" title="Destroy the application, close all resources.">HaliaApp::Destroy</a>( )
<a name="l00031"></a>00031       {
<a name="l00032"></a>00032             <span class="keyword">delete</span> mWindow;
<a name="l00033"></a>00033       };
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="class_halia_1_1_halia_app.html#44df2890693bfad600dea5cf2433f5f7">00035</a>       <span class="keywordtype">void</span> <a class="code" href="class_halia_1_1_halia_app.html#44df2890693bfad600dea5cf2433f5f7" title="Begin rendering.">HaliaApp::StartRendering</a>( )
<a name="l00036"></a>00036       {
<a name="l00037"></a>00037             <span class="comment">//:: Initialize frame rate counters</span>
<a name="l00038"></a>00038             mFrameCount = 0;
<a name="l00039"></a>00039             mBatchCount = 0;
<a name="l00040"></a>00040             mPrimCount = 0;
<a name="l00041"></a>00041             mStartTime = GetTickCount( );
<a name="l00042"></a>00042 
<a name="l00043"></a>00043             <span class="comment">//:: Start main render-loop</span>
<a name="l00044"></a>00044             <span class="keywordflow">while</span>( 1 )
<a name="l00045"></a>00045             {
<a name="l00046"></a>00046                   <span class="comment">//:: Process window events</span>
<a name="l00047"></a>00047                   <span class="keywordflow">if</span>( !mWindow-&gt;<a class="code" href="class_halia_1_1_window.html#0972d5678df94ba43546801d32037e22" title="Poll the message queue for any new events, returns false if the window is being/has...">Poll</a>( ) )
<a name="l00048"></a>00048                         <span class="keywordflow">break</span>;
<a name="l00049"></a>00049                   <a class="code" href="namespace_halia.html#84e92538a779c795b90f33acdb55aa09" title="Singleton Instance of the Input Manager.">IMInstance</a>-&gt;<a class="code" href="class_halia_1_1_input_manager.html#876948495043760389274266c603f6f5" title="Check for new events.">Poll</a>( );
<a name="l00050"></a>00050 
<a name="l00051"></a>00051                   <span class="comment">//:: Call preframe listener</span>
<a name="l00052"></a>00052                   <a class="code" href="class_halia_1_1_halia_app.html#de64f6adada5eec9bb5b1519853e7d3d" title="Event called prior to frame rendering.">PreFrame</a>( );
<a name="l00053"></a>00053 
<a name="l00054"></a>00054                   <span class="comment">//:: Clear the scene</span>
<a name="l00055"></a>00055                   <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;Clear( Color( 0xFFFFFFFF ) );
<a name="l00056"></a>00056                   <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;BeginScene( );
<a name="l00057"></a>00057 
<a name="l00058"></a>00058                   <span class="comment">//:: Call frame listener</span>
<a name="l00059"></a>00059                   <a class="code" href="class_halia_1_1_halia_app.html#9ef79cccc7f63b42c30a112784befe67" title="Event called after frame rendering.">Frame</a>( );
<a name="l00060"></a>00060 
<a name="l00061"></a>00061                   <span class="comment">//:: Render the overlays</span>
<a name="l00062"></a>00062                   <span class="comment">//ORInstance-&gt;DrawString( 10, 10, mSFps[0], 0xFF888888 );</span>
<a name="l00063"></a>00063                   <span class="comment">//ORInstance-&gt;DrawString( 10, 28, mSFps[1], 0xFF888888 );</span>
<a name="l00064"></a>00064                   <span class="comment">//ORInstance-&gt;DrawString( 10, 46, mSFps[2], 0xFF888888 );</span>
<a name="l00065"></a>00065                   <span class="comment">//ORInstance-&gt;Render( );</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067                   <span class="comment">//:: Finish rendering</span>
<a name="l00068"></a>00068                   <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;EndScene( );
<a name="l00069"></a>00069                   <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;Present( );
<a name="l00070"></a>00070 
<a name="l00071"></a>00071                   <span class="comment">//:: Frame rate stuff</span>
<a name="l00072"></a>00072                   mFrameCount++;
<a name="l00073"></a>00073                   mBatchCount += <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;GetBatchCount( );
<a name="l00074"></a>00074                   mPrimCount += <a class="code" href="namespace_halia.html#e74ce60071db020a95cad8ee0fe092ef" title="Singleton Instance of the Render System.">RSInstance</a>-&gt;GetPrimCount( );
<a name="l00075"></a>00075                   <span class="keywordflow">if</span>( GetTickCount( ) - mStartTime &gt;= 2000 ) {
<a name="l00076"></a>00076                         <span class="keywordtype">float</span> fps = (float)mFrameCount / ( GetTickCount( ) - mStartTime ) * 1000.0f;
<a name="l00077"></a>00077                         <span class="keywordtype">float</span> abc = (float)mBatchCount / mFrameCount;
<a name="l00078"></a>00078                         <span class="keywordtype">float</span> apc = (float)mPrimCount / mFrameCount;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                         sprintf( mSFps[0], <span class="stringliteral">"FPS: %4.2f"</span>, fps );
<a name="l00081"></a>00081                         sprintf( mSFps[1], <span class="stringliteral">"Average Prim Count: %4.0f"</span>, apc );
<a name="l00082"></a>00082                         sprintf( mSFps[2], <span class="stringliteral">"Average Batch Count: %4.0f"</span>, abc );
<a name="l00083"></a>00083                         <span class="comment">//printf( "FPS: %4.2f\n", fps );</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085                         mFrameCount = 0;
<a name="l00086"></a>00086                         mPrimCount = 0;
<a name="l00087"></a>00087                         mBatchCount = 0;
<a name="l00088"></a>00088                         mStartTime = GetTickCount( );
<a name="l00089"></a>00089                   }
<a name="l00090"></a>00090             };
<a name="l00091"></a>00091       };
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="class_halia_1_1_halia_app.html#cca52af1c9b7bd95bf2350f639b70fc2">00093</a>       <span class="keywordtype">void</span> <a class="code" href="class_halia_1_1_halia_app.html#cca52af1c9b7bd95bf2350f639b70fc2" title="Force the application to shut down.">HaliaApp::Quit</a>( )
<a name="l00094"></a>00094       {
<a name="l00095"></a>00095             PostQuitMessage( 0 );
<a name="l00096"></a>00096       };
<a name="l00097"></a>00097 };
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jun 24 07:17:14 2009 for Halia by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
