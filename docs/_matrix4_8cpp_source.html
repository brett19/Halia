<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Halia: Matrix4.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>Matrix4.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "Matrix4.hpp"</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="keyword">namespace </span>Halia
<a name="l00005"></a>00005 {
<a name="l00006"></a>00006       Matrix4::Matrix4( )
<a name="l00007"></a>00007       {
<a name="l00008"></a>00008             *<span class="keyword">this</span> = IDENTITY;
<a name="l00009"></a>00009       };
<a name="l00010"></a>00010 
<a name="l00011"></a>00011       Matrix4::Matrix4( <span class="keywordtype">float</span>* s )
<a name="l00012"></a>00012       {
<a name="l00013"></a>00013             <span class="keywordtype">float</span>* tmp = (<span class="keywordtype">float</span>*)<span class="keyword">this</span>;
<a name="l00014"></a>00014             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 16; ++i )
<a name="l00015"></a>00015                   *tmp++ = *s++;
<a name="l00016"></a>00016       };
<a name="l00017"></a>00017 
<a name="l00018"></a>00018       Matrix4::Matrix4( <span class="keywordtype">float</span> m11, <span class="keywordtype">float</span> m12, <span class="keywordtype">float</span> m13, <span class="keywordtype">float</span> m14, <span class="keywordtype">float</span> m21, <span class="keywordtype">float</span> m22, <span class="keywordtype">float</span> m23, <span class="keywordtype">float</span> m24, <span class="keywordtype">float</span> m31, <span class="keywordtype">float</span> m32, <span class="keywordtype">float</span> m33, <span class="keywordtype">float</span> m34, <span class="keywordtype">float</span> m41, <span class="keywordtype">float</span> m42, <span class="keywordtype">float</span> m43, <span class="keywordtype">float</span> m44 )
<a name="l00019"></a>00019       {
<a name="l00020"></a>00020             m[0][0] = m11;
<a name="l00021"></a>00021             m[0][1] = m12;
<a name="l00022"></a>00022             m[0][2] = m13;
<a name="l00023"></a>00023             m[0][3] = m14;
<a name="l00024"></a>00024             m[1][0] = m21;
<a name="l00025"></a>00025             m[1][1] = m22;
<a name="l00026"></a>00026             m[1][2] = m23;
<a name="l00027"></a>00027             m[1][3] = m24;
<a name="l00028"></a>00028             m[2][0] = m31;
<a name="l00029"></a>00029             m[2][1] = m32;
<a name="l00030"></a>00030             m[2][2] = m33;
<a name="l00031"></a>00031             m[2][3] = m34;
<a name="l00032"></a>00032             m[3][0] = m41;
<a name="l00033"></a>00033             m[3][1] = m42;
<a name="l00034"></a>00034             m[3][2] = m43;
<a name="l00035"></a>00035             m[3][3] = m44;
<a name="l00036"></a>00036       };
<a name="l00037"></a>00037 
<a name="l00038"></a>00038       Matrix4 Matrix4::operator*( <span class="keyword">const</span> Matrix4&amp; rhs )<span class="keyword"> const</span>
<a name="l00039"></a>00039 <span class="keyword">      </span>{
<a name="l00040"></a>00040             Matrix4 mat;
<a name="l00041"></a>00041             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 4; i++ )
<a name="l00042"></a>00042             {
<a name="l00043"></a>00043                   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; 4; j++ )
<a name="l00044"></a>00044                   {
<a name="l00045"></a>00045                         mat.m[i][j] = m[i][0] * rhs.m[0][j] + m[i][1] * rhs.m[1][j] + m[i][2] * rhs.m[2][j] + m[i][3] * rhs.m[3][j];
<a name="l00046"></a>00046                   }
<a name="l00047"></a>00047             }
<a name="l00048"></a>00048             <span class="keywordflow">return</span> mat;
<a name="l00049"></a>00049       };
<a name="l00050"></a>00050 
<a name="l00051"></a>00051       <span class="keywordtype">void</span> Matrix4::operator*=( <span class="keyword">const</span> Matrix4&amp; rhs )
<a name="l00052"></a>00052       {
<a name="l00053"></a>00053             (*this) = (*this) * rhs;
<a name="l00054"></a>00054       };
<a name="l00055"></a>00055 
<a name="l00056"></a>00056       <span class="keywordtype">float</span> Matrix4::Determinant( )<span class="keyword"> const</span>
<a name="l00057"></a>00057 <span class="keyword">      </span>{
<a name="l00058"></a>00058             Vector4 minor, v1, v2, v3;
<a name="l00059"></a>00059             v1.x = m[0][0]; v1.y = m[1][0]; v1.z = m[2][0]; v1.w = m[3][0];
<a name="l00060"></a>00060             v2.x = m[0][1]; v2.y = m[1][1]; v2.z = m[2][1]; v2.w = m[3][1];
<a name="l00061"></a>00061             v3.x = m[0][2]; v3.y = m[1][2]; v3.z = m[2][2]; v3.w = m[3][2];
<a name="l00062"></a>00062             minor = Vector4::CreateCross( v1, v2, v3 );
<a name="l00063"></a>00063             <span class="keywordflow">return</span> -( m[0][3] * minor.x + m[1][3] * minor.y + m[2][3] * minor.z + m[3][3] * minor.w );
<a name="l00064"></a>00064       };
<a name="l00065"></a>00065 
<a name="l00066"></a>00066       Vector3 Matrix4::TransformCoord( <span class="keyword">const</span> Vector3&amp; v )<span class="keyword"> const</span>
<a name="l00067"></a>00067 <span class="keyword">      </span>{
<a name="l00068"></a>00068             Vector3 vec( 0, 0, 0 );
<a name="l00069"></a>00069 
<a name="l00070"></a>00070             <span class="keywordtype">float</span> norm = m[0][3] * v.x + m[1][3] * v.y + m[2][3] * v.z + m[3][3];
<a name="l00071"></a>00071             <span class="keywordflow">if</span>( norm ) {
<a name="l00072"></a>00072                   vec.x = ( m[0][0] * v.x + m[1][0] * v.y + m[2][0] * v.z + m[3][0] ) / norm;
<a name="l00073"></a>00073                   vec.y = ( m[0][1] * v.x + m[1][1] * v.y + m[2][1] * v.z + m[3][1] ) / norm;
<a name="l00074"></a>00074                   vec.z = ( m[0][2] * v.x + m[1][2] * v.y + m[2][2] * v.z + m[3][2] ) / norm;
<a name="l00075"></a>00075             }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077             <span class="keywordflow">return</span> vec;
<a name="l00078"></a>00078       };
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       Matrix4 Matrix4::CreateInverse( <span class="keyword">const</span> Matrix4&amp; in )
<a name="l00081"></a>00081       {
<a name="l00082"></a>00082             Matrix4 mat;
<a name="l00083"></a>00083             Vector4 v, vec[3];
<a name="l00084"></a>00084 
<a name="l00085"></a>00085             <span class="keywordtype">float</span> det = in.Determinant( );
<a name="l00086"></a>00086             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 4; i++ )
<a name="l00087"></a>00087             {
<a name="l00088"></a>00088                   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; 4; j++ )
<a name="l00089"></a>00089                   {
<a name="l00090"></a>00090                         <span class="keywordflow">if</span>( j != i )
<a name="l00091"></a>00091                         {
<a name="l00092"></a>00092                               <span class="keywordtype">int</span> a = j;
<a name="l00093"></a>00093                               <span class="keywordflow">if</span>( j &gt; i ) a = a - 1;
<a name="l00094"></a>00094                               vec[a].x = in.m[j][0];
<a name="l00095"></a>00095                               vec[a].y = in.m[j][1];
<a name="l00096"></a>00096                               vec[a].z = in.m[j][2];
<a name="l00097"></a>00097                               vec[a].w = in.m[j][3];
<a name="l00098"></a>00098                         }
<a name="l00099"></a>00099                   }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101                   v = Vector4::CreateCross( vec[0], vec[1], vec[2] );
<a name="l00102"></a>00102                   mat.m[0][i] = pow( -1.0f, i ) * v.x / det;
<a name="l00103"></a>00103                   mat.m[1][i] = pow( -1.0f, i ) * v.y / det;
<a name="l00104"></a>00104                   mat.m[2][i] = pow( -1.0f, i ) * v.z / det;
<a name="l00105"></a>00105                   mat.m[3][i] = pow( -1.0f, i ) * v.w / det;
<a name="l00106"></a>00106             }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108             <span class="keywordflow">return</span> mat;
<a name="l00109"></a>00109       };
<a name="l00110"></a>00110 
<a name="l00111"></a>00111       Matrix4 Matrix4::CreatePerspectiveRH( <span class="keywordtype">float</span> w, <span class="keywordtype">float</span> h, <span class="keywordtype">float</span> zn, <span class="keywordtype">float</span> zf )
<a name="l00112"></a>00112       {
<a name="l00113"></a>00113             Matrix4 mat = IDENTITY;
<a name="l00114"></a>00114             mat.m[0][0] = 2.0f * zn / w;
<a name="l00115"></a>00115             mat.m[1][1] = 2.0f * zn / h;
<a name="l00116"></a>00116             mat.m[2][2] = zf / ( zn - zf );
<a name="l00117"></a>00117             mat.m[3][2] = ( zn * zf ) / ( zn - zf );
<a name="l00118"></a>00118             mat.m[2][3] = -1.0f;
<a name="l00119"></a>00119             mat.m[3][3] = 0.0f;
<a name="l00120"></a>00120             <span class="keywordflow">return</span> mat;
<a name="l00121"></a>00121       };
<a name="l00122"></a>00122 
<a name="l00123"></a>00123       Matrix4 Matrix4::CreatePerspectiveLH( <span class="keywordtype">float</span> w, <span class="keywordtype">float</span> h, <span class="keywordtype">float</span> zn, <span class="keywordtype">float</span> zf )
<a name="l00124"></a>00124       {
<a name="l00125"></a>00125             Matrix4 mat = IDENTITY;
<a name="l00126"></a>00126             mat.m[0][0] = 2.0f * zn / w;
<a name="l00127"></a>00127             mat.m[1][1] = 2.0f * zn / h;
<a name="l00128"></a>00128             mat.m[2][2] = zf / (zf - zn);
<a name="l00129"></a>00129             mat.m[3][2] = ( zn * zf ) / ( zn - zf );
<a name="l00130"></a>00130             mat.m[2][3] = 1.0f;
<a name="l00131"></a>00131             mat.m[3][3] = 0.0f;
<a name="l00132"></a>00132             <span class="keywordflow">return</span> mat;
<a name="l00133"></a>00133       };
<a name="l00134"></a>00134 
<a name="l00135"></a>00135       Matrix4 Matrix4::CreatePerspectiveFovRH( <span class="keywordtype">float</span> fovy, <span class="keywordtype">float</span> aspect, <span class="keywordtype">float</span> zn, <span class="keywordtype">float</span> zf )
<a name="l00136"></a>00136       {
<a name="l00137"></a>00137             Matrix4 mat = IDENTITY;
<a name="l00138"></a>00138             mat.m[0][0] = 1.0f / ( aspect * tan( fovy / 2.0f ) );
<a name="l00139"></a>00139             mat.m[1][1] = 1.0f / tan( fovy / 2.0f );
<a name="l00140"></a>00140             mat.m[2][2] = zf / ( zn - zf );
<a name="l00141"></a>00141             mat.m[2][3] = -1.0f;
<a name="l00142"></a>00142             mat.m[3][2] = ( zf * zn ) / ( zn - zf );
<a name="l00143"></a>00143             mat.m[3][3] = 0.0f;
<a name="l00144"></a>00144             <span class="keywordflow">return</span> mat;
<a name="l00145"></a>00145       };
<a name="l00146"></a>00146 
<a name="l00147"></a>00147       Matrix4 Matrix4::CreateRotation( <span class="keyword">const</span> Quarternion&amp; rot )
<a name="l00148"></a>00148       {
<a name="l00149"></a>00149             Matrix4 mat = IDENTITY;
<a name="l00150"></a>00150             mat.m[0][0] = 1.0f - 2.0f * (rot.y * rot.y + rot.z * rot.z );
<a name="l00151"></a>00151             mat.m[0][1] = 2.0f * ( rot.x *rot.y + rot.z * rot.w );
<a name="l00152"></a>00152             mat.m[0][2] = 2.0f * ( rot.x * rot.z - rot.y * rot.w );
<a name="l00153"></a>00153             mat.m[1][0] = 2.0f * ( rot.x * rot.y - rot.z * rot.w );
<a name="l00154"></a>00154             mat.m[1][1] = 1.0f - 2.0f * (rot.x * rot.x + rot.z * rot.z );
<a name="l00155"></a>00155             mat.m[1][2] = 2.0f * ( rot.y *rot.z + rot.x *rot.w );
<a name="l00156"></a>00156             mat.m[2][0] = 2.0f * ( rot.x * rot.z + rot.y * rot.w );
<a name="l00157"></a>00157             mat.m[2][1] = 2.0f * ( rot.y *rot.z - rot.x *rot.w );
<a name="l00158"></a>00158             mat.m[2][2] = 1.0f - 2.0f * ( rot.x * rot.x + rot.y * rot.y );
<a name="l00159"></a>00159             <span class="keywordflow">return</span> mat;
<a name="l00160"></a>00160       };
<a name="l00161"></a>00161 
<a name="l00162"></a>00162       Matrix4 Matrix4::CreateTranslation( Vector3 pos )
<a name="l00163"></a>00163       {
<a name="l00164"></a>00164             Matrix4 mat = IDENTITY;
<a name="l00165"></a>00165             mat.m[3][0] = pos.x;
<a name="l00166"></a>00166             mat.m[3][1] = pos.y;
<a name="l00167"></a>00167             mat.m[3][2] = pos.z;
<a name="l00168"></a>00168             <span class="keywordflow">return</span> mat;
<a name="l00169"></a>00169       };
<a name="l00170"></a>00170 
<a name="l00171"></a>00171       Matrix4 Matrix4::CreateTranslation2d( Vector3 pos )
<a name="l00172"></a>00172       {
<a name="l00173"></a>00173             Matrix4 mat = IDENTITY;
<a name="l00174"></a>00174             mat.m[2][0] = pos.x;
<a name="l00175"></a>00175             mat.m[2][1] = pos.y;
<a name="l00176"></a>00176             mat.m[2][2] = pos.z;
<a name="l00177"></a>00177             <span class="keywordflow">return</span> mat;
<a name="l00178"></a>00178       };
<a name="l00179"></a>00179 
<a name="l00180"></a>00180       Matrix4 Matrix4::CreateRotation( <span class="keywordtype">float</span> yaw, <span class="keywordtype">float</span> pitch, <span class="keywordtype">float</span> roll )
<a name="l00181"></a>00181       {
<a name="l00182"></a>00182             Matrix4 mat = IDENTITY;
<a name="l00183"></a>00183             mat *= CreateRotationZ( roll );
<a name="l00184"></a>00184             mat *= CreateRotationX( pitch );
<a name="l00185"></a>00185             mat *= CreateRotationY( yaw );
<a name="l00186"></a>00186             <span class="keywordflow">return</span> mat;
<a name="l00187"></a>00187       };
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       Matrix4 Matrix4::CreateScaling( Vector3 scale )
<a name="l00190"></a>00190       {
<a name="l00191"></a>00191             Matrix4 mat = IDENTITY;
<a name="l00192"></a>00192             mat.m[0][0] = scale.x;
<a name="l00193"></a>00193             mat.m[1][1] = scale.y;
<a name="l00194"></a>00194             mat.m[2][2] = scale.z;
<a name="l00195"></a>00195             <span class="keywordflow">return</span> mat;
<a name="l00196"></a>00196       };
<a name="l00197"></a>00197 
<a name="l00198"></a>00198       Matrix4 Matrix4::CreateRotationX( <span class="keywordtype">float</span> angle )
<a name="l00199"></a>00199       {
<a name="l00200"></a>00200             Matrix4 mat = IDENTITY;
<a name="l00201"></a>00201             mat.m[1][1] = cos( angle );
<a name="l00202"></a>00202             mat.m[2][2] = cos( angle );
<a name="l00203"></a>00203             mat.m[1][2] = sin( angle );
<a name="l00204"></a>00204             mat.m[2][1] = -sin( angle );
<a name="l00205"></a>00205             <span class="keywordflow">return</span> mat;
<a name="l00206"></a>00206       };
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       Matrix4 Matrix4::CreateRotationY( <span class="keywordtype">float</span> angle )
<a name="l00209"></a>00209       {
<a name="l00210"></a>00210             Matrix4 mat = IDENTITY;
<a name="l00211"></a>00211             mat.m[0][0] = cos( angle );
<a name="l00212"></a>00212             mat.m[2][2] = cos( angle );
<a name="l00213"></a>00213             mat.m[0][2] = -sin( angle );
<a name="l00214"></a>00214             mat.m[2][0] = sin( angle );
<a name="l00215"></a>00215             <span class="keywordflow">return</span> mat;
<a name="l00216"></a>00216       };
<a name="l00217"></a>00217 
<a name="l00218"></a>00218       Matrix4 Matrix4::CreateRotationZ( <span class="keywordtype">float</span> angle )
<a name="l00219"></a>00219       {
<a name="l00220"></a>00220             Matrix4 mat = IDENTITY;
<a name="l00221"></a>00221             mat.m[0][0] = cos( angle );
<a name="l00222"></a>00222             mat.m[1][1] = cos( angle );
<a name="l00223"></a>00223             mat.m[0][1] = sin( angle );
<a name="l00224"></a>00224             mat.m[1][0] = -sin( angle );
<a name="l00225"></a>00225             <span class="keywordflow">return</span> mat;
<a name="l00226"></a>00226       };
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       Matrix4 Matrix4::CreateLookAtRH( <span class="keyword">const</span> Vector3&amp; eye, <span class="keyword">const</span> Vector3&amp; target, <span class="keyword">const</span> Vector3&amp; up )
<a name="l00229"></a>00229       {
<a name="l00230"></a>00230             Matrix4 mat;
<a name="l00231"></a>00231             Vector3 right, rightn, upa, upn, vec, vec2;
<a name="l00232"></a>00232             vec2 = target - eye;
<a name="l00233"></a>00233             vec = Vector3::CreateNormalized( vec2 );
<a name="l00234"></a>00234             right = Vector3::CreateCross( up, vec );
<a name="l00235"></a>00235             upa = Vector3::CreateCross( vec, right );
<a name="l00236"></a>00236             rightn = Vector3::CreateNormalized( right );
<a name="l00237"></a>00237             upn = Vector3::CreateNormalized( upa );
<a name="l00238"></a>00238             mat.m[0][0] = -rightn.x;
<a name="l00239"></a>00239             mat.m[1][0] = -rightn.y;
<a name="l00240"></a>00240             mat.m[2][0] = -rightn.z;
<a name="l00241"></a>00241             mat.m[3][0] = Vector3::CreateDotProduct( rightn, eye );
<a name="l00242"></a>00242             mat.m[0][1] = upn.x;
<a name="l00243"></a>00243             mat.m[1][1] = upn.y;
<a name="l00244"></a>00244             mat.m[2][1] = upn.z;
<a name="l00245"></a>00245             mat.m[3][1] = -Vector3::CreateDotProduct( upn, eye );
<a name="l00246"></a>00246             mat.m[0][2] = -vec.x;
<a name="l00247"></a>00247             mat.m[1][2] = -vec.y;
<a name="l00248"></a>00248             mat.m[2][2] = -vec.z;
<a name="l00249"></a>00249             mat.m[3][2] = Vector3::CreateDotProduct( vec, eye );
<a name="l00250"></a>00250             mat.m[0][3] = 0.0f;
<a name="l00251"></a>00251             mat.m[1][3] = 0.0f;
<a name="l00252"></a>00252             mat.m[2][3] = 0.0f;
<a name="l00253"></a>00253             mat.m[3][3] = 1.0f;
<a name="l00254"></a>00254             <span class="keywordflow">return</span> mat;
<a name="l00255"></a>00255       };
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       Matrix4 Matrix4::CreateOrthoLH( <span class="keywordtype">float</span> w, <span class="keywordtype">float</span> h, <span class="keywordtype">float</span> zn, <span class="keywordtype">float</span> zf )
<a name="l00258"></a>00258       {
<a name="l00259"></a>00259             Matrix4 mat = IDENTITY;
<a name="l00260"></a>00260             mat.m[0][0] = 2.0f / w;
<a name="l00261"></a>00261             mat.m[1][1] = 2.0f / h;
<a name="l00262"></a>00262             mat.m[2][2] = 1.0f / ( zf - zn );
<a name="l00263"></a>00263             mat.m[3][2] = zn / ( zn - zf );
<a name="l00264"></a>00264             <span class="keywordflow">return</span> mat;
<a name="l00265"></a>00265       };
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="keyword">const</span> Matrix4 Matrix4::ZERO = Matrix4( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 );
<a name="l00268"></a>00268       <span class="keyword">const</span> Matrix4 Matrix4::IDENTITY = Matrix4( 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 );
<a name="l00269"></a>00269 };
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jun 24 07:17:15 2009 for Halia by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
